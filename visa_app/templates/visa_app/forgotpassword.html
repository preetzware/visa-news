{% extends "visa_app/base.html" %}

{% load i18n %}

{% block head_title %}{% trans "Forgot Password" %}{% endblock %}

{% block content %}
<div class="container d-flex justify-content-center align-items-center min-vh-100">
    <!-- Forgot Password Page -->
    <div class="card shadow-lg" style="max-width: 450px; width: 100%;">
        <div class="card-body p-5">
            <h3 class="text-center fw-bold mb-4 text-dark">{% trans "Forgot Password" %}</h3>
            <p class="text-center">{% trans "Enter your username and email address to reset your password." %}</p>
            <form method="POST" action="{% url 'account_reset_password' %}" id="passwordResetForm">
                {% csrf_token %}
                <!-- Username Field -->
                <div class="mb-3">
                    <label for="username" class="form-label">{% trans "Username" %}</label>
                    <input type="text" class="form-control" id="username" name="username" required>
                </div>
                <!-- Email Field -->
                <div class="mb-3">
                    <label for="email" class="form-label">{% trans "Email address" %}</label>
                    <input type="email" class="form-control" id="email" name="email" required>
                </div>
                <div class="d-grid">
                    <button class="btn btn-primary fw-bold" type="submit">{% trans "Reset Password" %}</button>
                </div>
            </form>
        </div>
    </div>
</div>

<!-- Confirmation Modal -->
<div class="modal fade" id="passwordResetConfirmationModal" tabindex="-1" aria-labelledby="passwordResetConfirmationLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content" style="border: 0.4rem solid #dee2e6; box-shadow: 0 0.5rem 1rem rgba(0, 0, 0, 0.15);">
            <div class="modal-header">
                <h5 class="modal-title" id="passwordResetConfirmationLabel">{% trans "Password Reset Sent" %}</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <!-- Modal message updated to include username -->
            <div class="modal-body">
                <p>{% trans "If an account matches the username below, you should receive an email with instructions on how to reset your password shortly." %}</p>
                <p id="usernameMessage"></p>
            </div>
        </div>
    </div>
</div>

<script>
    // Trigger the modal upon form submission
    document.getElementById('passwordResetForm').addEventListener('submit', function (e) {
        e.preventDefault(); // Prevent actual form submission

        // Capture the username and display it in the modal
        var username = document.getElementById('username').value;
        var usernameMessage = document.getElementById('usernameMessage');
        usernameMessage.textContent = "{% trans 'Username: ' %}" + username;

        // Show the confirmation modal
        var modal = new bootstrap.Modal(document.getElementById('passwordResetConfirmationModal'));
        modal.show();
    });
</script>
{% endblock %}
